<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Cart</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/cart.css">
</head>
<body>
    <%- include('../partials/header') %>

    <main class="container">
        <h1>Your Shopping Cart</h1>

        <% if (cart.items.length === 0) { %>
            <div class="empty-cart">
                <p>Your cart is currently empty.</p>
                <a href="/books/" class="btn">Continue Shopping</a>
            </div>
        <% } else { %>
            <div class="cart-items">
                <% cart.items.forEach(item => { %>
                    <div class="cart-item">
                        <img src="<%= item.bookId.imageUrl %>" alt="<%= item.bookId.title %>">
                        <div class="item-details">
                            <h3><%= item.bookId.title %></h3>
                            <p class="price">$<%= (item.priceAtAddition * item.quantity).toFixed(2) %></p>
                            <p>$<%= item.priceAtAddition.toFixed(2) %> each</p>
                            
                            <form action="/cart/update/<%= item.bookId._id %>" method="POST" class="quantity-form">
                                <input type="number" name="quantity" value="<%= item.quantity %>" min="1">
                                <button type="submit" class="btn">Update</button>
                            </form>
                            
                            <form action="/cart/remove/<%= item.bookId._id %>" method="POST">
                                <button type="submit" class="btn remove">Remove</button>
                            </form>
                        </div>
                    </div>
                <% }); %>
            </div>

            <div class="cart-summary">
                <h3>Order Summary</h3>
                <div class="summary-row">
                    <span>Subtotal (<%= cart.totalItems %> items):</span>
                    <span>$<%= cart.totalPrice.toFixed(2) %></span>
                </div>
                <div class="summary-row">
                    <span>Shipping:</span>
                    <span>FREE</span>
                </div>
                <div class="summary-row total">
                    <span>Total:</span>
                    <span>$<%= cart.totalPrice.toFixed(2) %></span>
                </div>

                <a href="/checkout" class="btn btn-primary">Proceed to Checkout</a>

                <form action="/cart/clear" method="POST">
                    <button type="submit" class="btn clear">Clear Cart</button>
                </form>
            </div>
        <% } %>
    </main>

    <%- include('../partials/footer') %>
    <script src="/js/cart.js"></script>
</body>
</html>